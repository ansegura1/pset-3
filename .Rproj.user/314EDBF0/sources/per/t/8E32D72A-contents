# TALLER 4: Webscraping en Twitter
# Esta version: Noviembre 2021
# Autores: Mariana Crane y Andres Ham

# Deja el espacio de trabajo en blanco
rm(list=ls(all=T))

# Paquetes necesarios (si no los tienen, instalar)
#install.packages(c("rtweet", "readr",))
library(readr)
library(dplyr)
library(tidyr)
library(rtweet)
library(tidytext)
library(ggplot2)
library(wordcloud)
library(ggraph)
library(igraph)
library(lubridate)
library(httpuv)
library(stringi)

# Creando la autenticación para ingresar a la API de twitter:
# http://127.0.0.1:1410 debe ir en la parte de callback URL al momento de configurar la aplicación 
# install.packages("httpuv") esta libraria debe estar instalada antes de crear los tokens

# Ruta
setwd("/Users/ham_andres/OneDrive - Universidad de Los Andes/Metodos Cuanti II/4 Talleres/4 webscraping/")

#Autorización para descargar datos
create_token(app="MCAP2_20202",
             consumer_key = "T9fLGmzA9Qt0T2JqENAt4gKMS",
             consumer_secret = "i4Y2O5Pe2IFuGD2UkX358EtQkVjUsBMVCi40VTncVXpVdWKjhT",
             access_token = "31338559-OdSizi0HDgaqJqYU22TTCLtNmdOHnK9VBsU5qSoWO",
             access_secret = "mmVuP31aVgEMonrEXtO2QYVTKzN7OCXCYLBOUNThYbwFJ") 

# 2A: Tendencias
col<-get_trends("colombia", exclude_hashtags=TRUE)

# Se queda con el Top10 que tiene info en tweet volume
col_trends<-data.frame(col$trend,col$tweet_volume)
col_trends<-na.omit(col_trends)
col_trends<-col_trends[order(col_trends$col.tweet_volume, decreasing=TRUE), ]
col_top10<-col_trends[1:10,]

# Grafico top 10 
pdf("./desarrollo/tendencias.pdf")
ggplot(col_top10, aes(x=reorder(col.trend,col.tweet_volume), y=col.tweet_volume)) + 
  geom_bar(stat = "identity", fill="purple3")+
  geom_text(aes(label=scales::comma(col.tweet_volume)), vjust=1.6, color="white", size=2)+
  theme_minimal() + ggtitle("Tendencias Twitter 9 noviembre 2021") + xlab("Tendencia") + ylab("Tweets") +
  theme(axis.text = element_text(size = 7)) + theme(plot.title = element_text(hjust = 0.5)) +
  scale_y_continuous(labels = scales::comma)
dev.off()
# Pueden sacar un cuadro o una grafico con las tendencias o contarnos en palabras en el word


# 2B: Cuentas
Alejandro<-get_timeline("agaviriau", n=3000)
Petro<-get_timeline("petrogustavo", n=3000)
Cabal<-get_timeline("MariaFdaCabal", n=3000)


